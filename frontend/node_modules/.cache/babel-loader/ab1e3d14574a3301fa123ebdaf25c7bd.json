{"ast":null,"code":"import _regeneratorRuntime from \"/Users/user/basis/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/user/basis/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/user/basis/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/Users/user/basis/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/user/basis/frontend/src/components/CreatePost.js\";\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: space-between;\\n  border-top: 1px solid \", \";\\n  padding: \", \" 0;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 150px;\\n  height: 150px;\\n  overflow: hidden;\\n  flex-shrink: 0;\\n  box-shadow: \", \";\\n\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  margin: 0 \", \";\\n  padding-left: \", \";\\n  padding-top: \", \";\\n  border: 0;\\n  outline: none;\\n  resize: none;\\n  transition: 0.1s ease-out;\\n  height: \", \";\\n  font-size: \", \";\\n  background-color: \", \";\\n  border-radius: \", \";\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: space-between;\\n  padding: \", \" 0;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  border: 0;\\n  border: 1px solid \", \";\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState } from 'react';\nimport { useMutation } from '@apollo/client';\nimport styled from 'styled-components';\nimport { Spacing, Overlay, Container } from 'components/Layout';\nimport { Error } from 'components/Text';\nimport { Button } from 'components/Form';\nimport Avatar from 'components/Avatar';\nimport PostImageUpload from 'pages/Home/PostImageUpload';\nimport { GET_FOLLOWED_POSTS, CREATE_POST } from 'graphql/post';\nimport { GET_AUTH_USER, GET_USER_POSTS } from 'graphql/user';\nimport { useStore } from 'store';\nimport { PROFILE_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { HOME_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { MAX_POST_IMAGE_SIZE } from 'constants/ImageSize';\nimport { useGlobalMessage } from 'hooks/useGlobalMessage';\nvar Root = styled(Container)(_templateObject(), function (p) {\n  return p.theme.colors.border.main;\n});\nvar Wrapper = styled.div(_templateObject2(), function (p) {\n  return p.theme.spacing.sm;\n});\nvar Textarea = styled.textarea(_templateObject3(), function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.theme.spacing.sm;\n}, function (p) {\n  return p.theme.spacing.xs;\n}, function (p) {\n  return p.focus ? '80px' : '40px';\n}, function (p) {\n  return p.theme.font.size.xs;\n}, function (p) {\n  return p.theme.colors.grey[100];\n}, function (p) {\n  return p.theme.radius.md;\n});\nvar ImagePreviewContainer = styled.div(_templateObject4(), function (p) {\n  return p.theme.shadows.sm;\n});\nvar ImagePreview = styled.img(_templateObject5());\nvar Options = styled.div(_templateObject6(), function (p) {\n  return p.theme.colors.border.main;\n}, function (p) {\n  return p.theme.spacing.sm;\n});\nvar Buttons = styled.div(_templateObject7());\n/**\n * Component for creating a post\n */\n\nvar CreatePost = function CreatePost() {\n  var _useStore = useStore(),\n      _useStore2 = _slicedToArray(_useStore, 1),\n      auth = _useStore2[0].auth;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      title = _useState2[0],\n      setTitle = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      image = _useState4[0],\n      setImage = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isFocused = _useState6[0],\n      setIsFocused = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      error = _useState8[0],\n      setError = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      apiError = _useState10[0],\n      setApiError = _useState10[1];\n\n  var message = useGlobalMessage();\n\n  var _useMutation = useMutation(CREATE_POST, {\n    refetchQueries: [{\n      query: GET_FOLLOWED_POSTS,\n      variables: {\n        userId: auth.user.id,\n        skip: 0,\n        limit: HOME_PAGE_POSTS_LIMIT\n      }\n    }, {\n      query: GET_AUTH_USER\n    }, {\n      query: GET_USER_POSTS,\n      variables: {\n        username: auth.user.username,\n        skip: 0,\n        limit: PROFILE_PAGE_POSTS_LIMIT\n      }\n    }]\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      createPost = _useMutation2[0],\n      loading = _useMutation2[1].loading;\n\n  var handleReset = function handleReset() {\n    setTitle('');\n    setImage('');\n    setIsFocused(false);\n    setError('');\n    setApiError(false);\n  };\n\n  var handleOnFocus = function handleOnFocus() {\n    return setIsFocused(true);\n  };\n\n  var handlePostImageUpload = function handlePostImageUpload(e) {\n    var file = e.target.files[0];\n    if (!file) return;\n\n    if (file.size >= MAX_POST_IMAGE_SIZE) {\n      message.error(\"File size should be less then \".concat(MAX_POST_IMAGE_SIZE / 1000000, \"MB\"));\n      return;\n    }\n\n    setImage(file);\n    setIsFocused(true);\n    e.target.value = null;\n  };\n\n  var handleTitleChange = function handleTitleChange(e) {\n    return setTitle(e.target.value);\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              _context.prev = 1;\n              _context.next = 4;\n              return createPost({\n                variables: {\n                  input: {\n                    title,\n                    image,\n                    authorId: auth.user.id\n                  }\n                }\n              });\n\n            case 4:\n              handleReset();\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](1);\n              setApiError(true);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 7]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var isShareDisabled = loading || !loading && !image && !title;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, isFocused && /*#__PURE__*/React.createElement(Overlay, {\n    onClick: handleReset,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(Root, {\n    zIndex: isFocused ? 'md' : 'xs',\n    color: \"white\",\n    radius: \"sm\",\n    padding: \"sm\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Wrapper, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Avatar, {\n    image: auth.user.image,\n    size: 40,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Textarea, {\n    type: \"textarea\",\n    name: \"title\",\n    focus: isFocused,\n    value: title,\n    onFocus: handleOnFocus,\n    onChange: handleTitleChange,\n    placeholder: \"Add a post\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 13\n    }\n  }), !isFocused && /*#__PURE__*/React.createElement(PostImageUpload, {\n    handleChange: handlePostImageUpload,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 28\n    }\n  })), image && /*#__PURE__*/React.createElement(Spacing, {\n    bottom: \"sm\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(ImagePreviewContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ImagePreview, {\n    src: URL.createObjectURL(image),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 17\n    }\n  }))), isFocused && /*#__PURE__*/React.createElement(Options, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(PostImageUpload, {\n    label: \"Photo\",\n    handleChange: handlePostImageUpload,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Buttons, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    text: true,\n    type: \"button\",\n    onClick: handleReset,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }\n  }, \"Cancel\"), /*#__PURE__*/React.createElement(Button, {\n    disabled: isShareDisabled,\n    type: \"submit\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 17\n    }\n  }, \"Share\"))), apiError || error && /*#__PURE__*/React.createElement(Spacing, {\n    top: \"xs\",\n    bottom: \"sm\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Error, {\n    size: \"xs\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 17\n    }\n  }, apiError ? 'Something went wrong, please try again.' : error)))));\n};\n\nexport default CreatePost;","map":{"version":3,"sources":["/Users/user/basis/frontend/src/components/CreatePost.js"],"names":["React","useState","useMutation","styled","Spacing","Overlay","Container","Error","Button","Avatar","PostImageUpload","GET_FOLLOWED_POSTS","CREATE_POST","GET_AUTH_USER","GET_USER_POSTS","useStore","PROFILE_PAGE_POSTS_LIMIT","HOME_PAGE_POSTS_LIMIT","MAX_POST_IMAGE_SIZE","useGlobalMessage","Root","p","theme","colors","border","main","Wrapper","div","spacing","sm","Textarea","textarea","xs","focus","font","size","grey","radius","md","ImagePreviewContainer","shadows","ImagePreview","img","Options","Buttons","CreatePost","auth","title","setTitle","image","setImage","isFocused","setIsFocused","error","setError","apiError","setApiError","message","refetchQueries","query","variables","userId","user","id","skip","limit","username","createPost","loading","handleReset","handleOnFocus","handlePostImageUpload","e","file","target","files","value","handleTitleChange","handleSubmit","preventDefault","input","authorId","isShareDisabled","URL","createObjectURL"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { useMutation } from '@apollo/client';\nimport styled from 'styled-components';\n\nimport { Spacing, Overlay, Container } from 'components/Layout';\nimport { Error } from 'components/Text';\nimport { Button } from 'components/Form';\nimport Avatar from 'components/Avatar';\n\nimport PostImageUpload from 'pages/Home/PostImageUpload';\n\nimport { GET_FOLLOWED_POSTS, CREATE_POST } from 'graphql/post';\nimport { GET_AUTH_USER, GET_USER_POSTS } from 'graphql/user';\n\nimport { useStore } from 'store';\n\nimport { PROFILE_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { HOME_PAGE_POSTS_LIMIT } from 'constants/DataLimit';\nimport { MAX_POST_IMAGE_SIZE } from 'constants/ImageSize';\n\nimport { useGlobalMessage } from 'hooks/useGlobalMessage';\n\nconst Root = styled(Container)`\n  border: 0;\n  border: 1px solid ${(p) => p.theme.colors.border.main};\n`;\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  padding: ${(p) => p.theme.spacing.sm} 0;\n`;\n\nconst Textarea = styled.textarea`\n  width: 100%;\n  margin: 0 ${(p) => p.theme.spacing.xs};\n  padding-left: ${(p) => p.theme.spacing.sm};\n  padding-top: ${(p) => p.theme.spacing.xs};\n  border: 0;\n  outline: none;\n  resize: none;\n  transition: 0.1s ease-out;\n  height: ${(p) => (p.focus ? '80px' : '40px')};\n  font-size: ${(p) => p.theme.font.size.xs};\n  background-color: ${(p) => p.theme.colors.grey[100]};\n  border-radius: ${(p) => p.theme.radius.md};\n`;\n\nconst ImagePreviewContainer = styled.div`\n  width: 150px;\n  height: 150px;\n  overflow: hidden;\n  flex-shrink: 0;\n  box-shadow: ${(p) => p.theme.shadows.sm};\n`;\n\nconst ImagePreview = styled.img`\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n`;\n\nconst Options = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  border-top: 1px solid ${(p) => p.theme.colors.border.main};\n  padding: ${(p) => p.theme.spacing.sm} 0;\n`;\n\nconst Buttons = styled.div`\n  display: flex;\n  flex-direction: row;\n`;\n\n/**\n * Component for creating a post\n */\nconst CreatePost = () => {\n  const [{ auth }] = useStore();\n  const [title, setTitle] = useState('');\n  const [image, setImage] = useState('');\n  const [isFocused, setIsFocused] = useState(false);\n  const [error, setError] = useState('');\n  const [apiError, setApiError] = useState(false);\n  const message = useGlobalMessage();\n  const [createPost, { loading }] = useMutation(CREATE_POST, {\n    refetchQueries: [\n      {\n        query: GET_FOLLOWED_POSTS,\n        variables: {\n          userId: auth.user.id,\n          skip: 0,\n          limit: HOME_PAGE_POSTS_LIMIT,\n        },\n      },\n      { query: GET_AUTH_USER },\n      {\n        query: GET_USER_POSTS,\n        variables: {\n          username: auth.user.username,\n          skip: 0,\n          limit: PROFILE_PAGE_POSTS_LIMIT,\n        },\n      },\n    ],\n  });\n\n  const handleReset = () => {\n    setTitle('');\n    setImage('');\n    setIsFocused(false);\n    setError('');\n    setApiError(false);\n  };\n\n  const handleOnFocus = () => setIsFocused(true);\n\n  const handlePostImageUpload = (e) => {\n    const file = e.target.files[0];\n\n    if (!file) return;\n\n    if (file.size >= MAX_POST_IMAGE_SIZE) {\n      message.error(`File size should be less then ${MAX_POST_IMAGE_SIZE / 1000000}MB`);\n      return;\n    }\n\n    setImage(file);\n\n    setIsFocused(true);\n    e.target.value = null;\n  };\n\n  const handleTitleChange = (e) => setTitle(e.target.value);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      await createPost({\n        variables: { input: { title, image, authorId: auth.user.id } },\n      });\n      handleReset();\n    } catch (error) {\n      setApiError(true);\n    }\n  };\n\n  const isShareDisabled = loading || (!loading && !image && !title);\n\n  return (\n    <>\n      {isFocused && <Overlay onClick={handleReset} />}\n\n      <Root zIndex={isFocused ? 'md' : 'xs'} color=\"white\" radius=\"sm\" padding=\"sm\">\n        <form onSubmit={handleSubmit}>\n          <Wrapper>\n            <Avatar image={auth.user.image} size={40} />\n\n            <Textarea\n              type=\"textarea\"\n              name=\"title\"\n              focus={isFocused}\n              value={title}\n              onFocus={handleOnFocus}\n              onChange={handleTitleChange}\n              placeholder=\"Add a post\"\n            />\n\n            {!isFocused && <PostImageUpload handleChange={handlePostImageUpload} />}\n          </Wrapper>\n\n          {image && (\n            <Spacing bottom=\"sm\">\n              <ImagePreviewContainer>\n                <ImagePreview src={URL.createObjectURL(image)} />\n              </ImagePreviewContainer>\n            </Spacing>\n          )}\n\n          {isFocused && (\n            <Options>\n              <PostImageUpload label=\"Photo\" handleChange={handlePostImageUpload} />\n\n              <Buttons>\n                <Button text type=\"button\" onClick={handleReset}>\n                  Cancel\n                </Button>\n                <Button disabled={isShareDisabled} type=\"submit\">\n                  Share\n                </Button>\n              </Buttons>\n            </Options>\n          )}\n\n          {apiError ||\n            (error && (\n              <Spacing top=\"xs\" bottom=\"sm\">\n                <Error size=\"xs\">{apiError ? 'Something went wrong, please try again.' : error}</Error>\n              </Spacing>\n            ))}\n        </form>\n      </Root>\n    </>\n  );\n};\n\nexport default CreatePost;\n"]},"metadata":{},"sourceType":"module"}